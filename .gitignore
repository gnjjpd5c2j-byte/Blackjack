// ==UserScript==
// @name         24/7 Blackjack Strategy Helper
// @version      1.0
// @description  Displays blackjack basic strategy advice (Userscripts iOS compatible)
// @match        *://*/*
// ==/UserScript==

(function () {
    'use strict';

    /* Try multiple common selectors used by 24/7 blackjack sites */
    const PLAYER_SELECTORS = [
        '.player-cards',
        '.player-hand',
        '.hand.player',
        '.cards.player'
    ];

    const DEALER_SELECTORS = [
        '.dealer-cards',
        '.dealer-hand',
        '.hand.dealer',
        '.cards.dealer'
    ];

    function findElement(selectors) {
        for (const sel of selectors) {
            const el = document.querySelector(sel);
            if (el) return el;
        }
        return null;
    }

    function parseCards(text) {
        return text.match(/A|K|Q|J|10|[2-9]/g) || [];
    }

    function cardValue(c) {
        if (['J','Q','K'].includes(c)) return 10;
        if (c === 'A') return 11;
        return parseInt(c, 10);
    }

    function handValue(cards) {
        let total = 0;
        let aces = 0;
        cards.forEach(c => {
            total += cardValue(c);
            if (c === 'A') aces++;
        });
        while (total > 21 && aces > 0) {
            total -= 10;
            aces--;
        }
        return total;
    }

    function isSoft(cards) {
        return cards.includes('A') && handValue(cards) <= 21;
    }

    function advice(player, dealer) {
        const total = handValue(player);
        const soft = isSoft(player);
        const d = cardValue(dealer);

        if (player.length === 2 && player[0] === player[1]) {
            if (player[0] === 'A' || player[0] === '8') return 'SPLIT';
        }

        if (soft) {
            if (total >= 19) return 'STAND';
            if (total === 18 && d <= 6) return 'STAND';
            return 'HIT';
        }

        if (total >= 17) return 'STAND';
        if (total <= 11) return 'HIT';
        if (total >= 12 && total <= 16) return d >= 7 ? 'HIT' : 'STAND';

        return 'HIT';
    }

    /* Floating UI */
    const box = document.createElement('div');
    box.style.cssText = `
        position: fixed;
        bottom: 14px;
        right: 14px;
        background: #000;
        color: #00ff00;
        padding: 10px 14px;
        font-family: monospace;
        font-size: 14px;
        border-radius: 8px;
        z-index: 999999;
    `;
    box.textContent = '24/7 Blackjack Helper: waiting…';
    document.body.appendChild(box);

    setInterval(() => {
        const playerEl = findElement(PLAYER_SELECTORS);
        const dealerEl = findElement(DEALER_SELECTORS);
        if (!playerEl || !dealerEl) return;

        const pc = parseCards(playerEl.innerText);
        const dc = parseCards(dealerEl.innerText);
        if (!pc.length || !dc.length) return;

        box.textContent =
            `You: ${handValue(pc)} | Dealer: ${dc[0]} → ${advice(pc, dc[0])}`;
    }, 900);
})();
